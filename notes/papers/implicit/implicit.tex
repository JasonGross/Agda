% Implicit arguments
% Author: Catarina Coquand and Ulf Norell

%\documentclass[12pt,a4paper]{amsart}
\documentclass[11pt]{article}

\usepackage{amsthm}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}


\usepackage{epsf}
\usepackage{epsfig}
%\usepackage{isolatin1}
%\usepackage{a4wide}
\usepackage{verbatim}
\usepackage{proof}
\usepackage{latexsym}
\usepackage{amssymb,amsmath}
\usepackage{stmaryrd}

\input{macros}

\title{Implicit Arguments}
\author{Catarina Coquand and Ulf Norell}
\date{\today}

\begin{document}


\maketitle

\section{Core}

\[\begin{array}{lclr}
    A	   & ::= & \SET \Or \EL M \Or \PI xAA		& types \\
    M	   & ::= & x \Or c \Or f \Or M\,M \Or \LAM xM	& terms \\
    \Gamma & ::= & () \Or \Gamma,x:A			& contexts \\
    \Sigma & ::= & () \Or \Sigma,c:A \Or \Sigma,f:A=M	& signatures \\
\end{array}\]

 There are six kinds of judgement 
\[\begin{array}{ll}
    \IsSigCS\Sigma & \mbox{$\Sigma$ is a valid signature} \\
    \IsCtxCS\Sigma\Gamma & \mbox{$\Gamma$ is a valid context} \\
    \IsTypeCS\Sigma\Gamma A & \mbox{$A$ is a valid type in $\Gamma$} \\
    \HasTypeCS\Sigma\Gamma MA & \mbox{$M$ has type $A$ in $\Gamma$} \\
    \EqualTypeCS\Sigma\Gamma AB & \mbox{$A$ and $B$ are convertible types in $\Gamma$}\\
    \EqualCS\Sigma\Gamma MNA & \mbox{$M$ and $N$ are convertible terms of type $A$ in $\Gamma$} \\
\end{array}\]

 We will leave $\Sigma$ implicit whenever possible.

 The typing rules are as follows:

\medskip

 {\em rules for signatures}

\[\begin{array}{ccccc}
    \infer{\IsSigCS{()}}{}
&&  \infer{\IsSigCS{\Sigma,c:A}}{
      \IsSigCS\Sigma
    & \IsTypeCS\Sigma{()}A
    }
&&  \infer{\IsSigCS{\Sigma,f:A=M}}{
      \IsSigCS\Sigma
    & \IsTypeCS\Sigma{()}A
    & \HasTypeCS\Sigma{()}MA
    }
\end{array}\]

 {\em rules for contexts}

\[\begin{array}{ccc}
    \infer{\IsCtxCS\Sigma{()}}{\IsSigCS\Sigma}
&&  \infer{\IsCtxC{\Gamma,x:A}}{
      \IsCtxC\Gamma
    & \IsTypeC\Gamma A
    }
\end{array}\]

 {\em rules for types}

\[\begin{array}{ccccc}
    \infer{\IsTypeC\Gamma\SET}{\IsCtxC\Gamma}
&&  \infer{\IsTypeC\Gamma{\EL M}}{\HasTypeC\Gamma M\SET}
&&  \infer{\IsTypeC\Gamma{\PI xAB}}{\IsTypeC{\Gamma,x:A}B}
\end{array}\]

 {\em rules for terms}

\[\begin{array}{ccccc}
    \infer{\HasTypeC\Gamma xA}{
      \IsCtxC\Gamma
    & x:A\in\Gamma
    }
&&  \infer{\HasTypeCS\Sigma\Gamma cA}{
    & \IsCtxC\Gamma
    & c:A\in\Sigma
    }
&&  \infer{\HasTypeCS\Sigma\Gamma fA}{
      \IsCtxC\Gamma
    & f:A=M\in\Sigma
    }
\\{}\\
\multicolumn5c{\begin{array}{ccc}
    \infer{\HasTypeC\Gamma{\LAM xM}{\PI xAB}}{
      \HasTypeC{\Gamma,x:A}MB
    }
&&  \infer{\HasTypeC\Gamma{M\,N}{\Subst BxN}}{
      \HasTypeC\Gamma M{\PI xAB}
    & \HasTypeC\Gamma NA
    }
\end{array}}
\\{}\\
&&
    \infer{\HasTypeC\Gamma MB}{
      \HasTypeC\Gamma MA
    & \EqualTypeC\Gamma AB
    }
\end{array}\]

  {\em general converion rules}

\[\begin{array}{c}
\begin{array}{ccccc}
    \infer{\EqualTypeC\Gamma AA}{\IsTypeC\Gamma A}
&&  \infer{\EqualTypeC\Gamma BA}{\EqualTypeC\Gamma AB}
&&  \infer{\EqualTypeC\Gamma AC}{\EqualTypeC\Gamma AB & \EqualTypeC\Gamma BC}
\end{array} \\{}\\
\begin{array}{ccccc}
    \infer{\EqualC\Gamma MMA}{\HasTypeC\Gamma MA}
&&  \infer{\EqualC\Gamma NMA}{\EqualC\Gamma MNA}
&&  \infer{\EqualC\Gamma MPA}{\EqualC\Gamma MNA & \EqualC\Gamma NPA}
\end{array} \\{}\\
\begin{array}{ccc}
    \infer{\EqualC\Gamma MNB}{\EqualC\Gamma MNA & \EqualTypeC\Gamma AB}
&&  \infer{\EqualTypeC\Gamma{\Subst BxM}{\Subst BxN}}{
      \IsTypeC{\Gamma,x:A}B
    & \EqualC\Gamma MNA
    }
\end{array}
\end{array}\]

  {\em conversion rules for type theory}

\[\begin{array}{c}
\begin{array}{ccccc}
    \infer{\EqualTypeC\Gamma\SET\SET}{}
&&  \infer{\EqualTypeC\Gamma{\EL M}{\EL N}}{\EqualC\Gamma MN\SET}
&&  \infer{\EqualTypeC\Gamma{\PI x{A_1}{B_1}}{\PI x{A_2}{B_2}}}{
      \EqualTypeC\Gamma{A_1}{A_2}
    & \EqualTypeC{\Gamma,x:A_2}{B_1}{B_2}
    }
\end{array}
\\{}\\
    \infer{\EqualC\Gamma{\LAM xM}{\LAM xN}{\PI xAB}}{\EqualC{\Gamma,x:A}MNB}
\\{}\\
    \infer{\EqualC\Gamma{M_1\,N_1}{M_2\,N_2}{\Subst Bx{N_1}}}{
      \IsTypeC{\Gamma,x:A}B
    & \EqualC\Gamma{M_1}{M_2}{\PI xAB}
    & \EqualC\Gamma{N_1}{N_2}A
    }
\\{}\\
\begin{array}{ccc}
    \infer{\EqualC\Gamma{(\LAM xM)\,N}{\Subst MxN}{\Subst BxN}}{
      \HasTypeC{\Gamma,x:A}MB
    & \HasTypeC\Gamma MA
    }
&&  \infer{\EqualC\Gamma M{\LAM xM\,x}{\PI xAB}}{
      \IsTypeC\Gamma A
    & \HasTypeC\Gamma M{\PI xAB}
    }
\end{array}
\\{}\\
    \infer{\EqualCS\Sigma\Gamma fMA}{f:A=M \in \Sigma}
\end{array}\]

 In this presentation of rules, we consider $\lambda$ terms up to  $\alpha$-conversion.

% \subsection{Type checking}
% 
% $$
% \frac{(x{:}A)~\in~\Gamma}{\Gamma\vdash x\downarrow A}~~~~~~~~~
% \frac{\Gamma\vdash M\downarrow (x{:}A)\rightarrow B~~~~\Gamma\vdash N\uparrow A}
%      {\Gamma\vdash M~N\downarrow B(x=N)}
% $$
% and
% $$
% \frac{\Gamma,x{:}A\vdash M\uparrow B}{\Gamma\vdash \lambda x.M\uparrow (x{:}A)\rightarrow B}~~~~
% \frac{\Gamma\vdash M\downarrow A~~~~\Gamma\vdash A = B}{\Gamma\vdash M\uparrow B}
% $$
% 
% $$
% \frac{}{\Gamma\vdash \SET\downarrow}~~~~
% \frac{\Gamma\vdash M\downarrow\SET}{\Gamma\vdash \EL~M\downarrow}~~~~~~
% \frac{\Gamma\vdash A\downarrow~~~~~\Gamma,x{:}A\vdash B\downarrow}{\Gamma\vdash (x{:}A)\rightarrow B\downarrow}
% $$
% 
% \begin{theorem}
% If $M$ is in $\beta$-normal form and $\HasTypeC\Gamma MA$ then $\Gamma\vdash M\uparrow A$.
% \end{theorem}
% 

\section{Implicit Core}

Meta variables in Implicit Core are represented by function symbols. We
will use $\Meta n$ for these function symbols to distinguish them from
constants ($c$) and defined functions ($f$).

We make the typing rules relative to a set of constraints of the form
$\Constr\Sigma\Gamma MNA$.

\[\begin{array}{l}
    \IsSigIS\C\Sigma \\
    \IsCtxIS\C\Sigma\Gamma \\
    \IsTypeIS\C\Sigma\Gamma A \\
    \HasTypeIS\C\Sigma\Gamma MA \\
    \EqualTypeIS\C\Sigma\Gamma AB \\
    \EqualIS\C\Sigma\Gamma MNA \\
\end{array}\]

The rules are otherwise unchanged and we add the new rule:

\[\begin{array}{c}
    \infer{\EqualIS\Sigma\C\Gamma MNA}{\Constr\Sigma\Gamma MNA\in\C}
\end{array}\]

\begin{definition}
    We say that $\gamma$ is an {\em instantiation} of a well-formed signature
    $\Sigma$, written $\gamma:\Sigma$, if it to each declaration $\Meta n:A$ in
    $\Sigma$ assigns a term $M$ such that the signature acquired by replacing
    $\Meta n:A$ by $\Meta n:A=M$ is well-formed in Core. We write $\gamma\Sigma$
    for this instantiated signature.
\end{definition}

\begin{definition}
    An instantiation $\gamma:\Sigma_0$ is a {\em solution} to a set of
    constraints $\C$, written $\gamma\Solves\C$, if for all
    $\Constr\Sigma\Gamma MNA\in\C$ it is the case that $\Sigma$ is a prefix of
    $\Sigma_0$ and $\EqualCS{\gamma\Sigma}\Gamma MNA$.
\end{definition}

Note that if $\gamma:\Sigma_0$ and $\Sigma$ is a prefix of $\Sigma_0$ then $\gamma:\Sigma$.

\begin{definition}
    Given an signature $\Sigma$ we define the constraint set $\SigConstr\Sigma$ as follows
    \[\begin{array}{lcl}
	\SigConstr{()}		 & = & \emptyset \\
	\SigConstr{\Sigma,c:A}	 & = & \SigConstr\Sigma \\
	\SigConstr{\Sigma,f:A=M} & = & \{\Constr\Sigma{()}fMA\}\cup\SigConstr\Sigma \\
    \end{array}\]
\end{definition}

\begin{theorem}[Soundness]
    If $\HasTypeIS\C\Sigma\Gamma MA$ and $\gamma\Solves\C$ then $\HasTypeCS{\gamma\Sigma}\Gamma MA$.
\end{theorem}

\begin{proof}
    By simultaneous induction on the derivations.
\end{proof}

\begin{theorem}[Completeness]
    If $\HasTypeCS{\gamma\Sigma}\Gamma MA$ then $\HasTypeIS{\SigConstr{\gamma\Sigma}}\Sigma\Gamma MA$.
\end{theorem}

\end{document}

